<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>World Builder Utility</title>
    <link rel="stylesheet" href="/style.css" />
    <link rel="stylesheet" href="/world-builder.css" />
  </head>
  <body class="world-builder">
    <header class="builder-header">
      <h1>World Mode Builder</h1>
      <p>Create and export world configuration files for developers.</p>
      <a class="builder-link" href="/">← Back to Game</a>
    </header>

    <div id="builder-loading" class="builder-loading">
      <div class="loading-panel">
        <p>Loading developer catalogs…</p>
      </div>
    </div>

    <main id="builder-wrapper" class="builder-wrapper hidden">
      <nav class="builder-tabs">
        <button type="button" class="tab-button active" data-tab="world">World</button>
        <button type="button" class="tab-button" data-tab="sprites">Sprites</button>
        <button type="button" class="tab-button" data-tab="enemies">Enemies</button>
        <button type="button" class="tab-button" data-tab="npcs">NPCs</button>
      </nav>

      <section class="builder-tab active" data-tab-panel="world">
        <div id="builder" class="builder-layout">
          <div class="builder-column builder-column-settings">
            <section class="panel">
              <h2>World Settings</h2>
              <label class="field-label">
                World ID
                <input id="world-id" type="text" placeholder="unique_world_id" />
              </label>
              <label class="field-label">
                World Name
                <input id="world-name" type="text" placeholder="World Name" />
              </label>
              <label class="field-inline">
                <span>Tile Size</span>
                <input id="world-tile-size" type="number" min="8" value="32" />
              </label>
              <label class="field-inline">
                <span>Move Cooldown (ms)</span>
                <input id="world-move-cooldown" type="number" min="0" value="180" />
              </label>
              <label class="field-inline">
                <span>Encounter Enemy Count</span>
                <input id="world-enemy-count" type="number" min="1" value="6" />
              </label>
              <label class="field-inline">
                <span>Encounter Tiles</span>
                <input id="world-encounter-tiles" type="text" placeholder="e.g. 2" />
              </label>
              <label class="field-inline">
                <span>Encounter Chance</span>
                <input
                  id="world-encounter-chance"
                  type="number"
                  min="0"
                  max="1"
                  step="0.01"
                  value="0.22"
                />
              </label>
              <label class="field-inline">
                <span>Encounter Cooldown (ms)</span>
                <input id="world-encounter-cooldown" type="number" min="0" value="2000" />
              </label>
            </section>

            <section class="panel palette-panel">
              <div class="panel-header">
                <h2>Tile Palette</h2>
                <div class="panel-actions">
                  <label class="field-inline">
                    <span>Palette</span>
                    <select id="palette-select"></select>
                  </label>
                  <button type="button" class="panel-link" data-tab-target="sprites">
                    Edit Palette
                  </button>
                </div>
              </div>
              <div id="tile-palette" class="tile-palette"></div>
              <p class="panel-note">Palettes are editable from the Sprites tab.</p>
            </section>

            <section class="panel enemy-picker-panel">
              <div class="panel-header">
                <h2>Enemy Templates</h2>
                <button type="button" class="panel-link" data-tab-target="enemies">
                  Manage
                </button>
              </div>
              <div id="enemy-picker-list" class="enemy-template-list enemy-template-list--compact"></div>
            </section>
            <section class="panel npc-picker-panel">
              <div class="panel-header">
                <h2>NPC Placements</h2>
                <button type="button" class="panel-link" data-tab-target="npcs">
                  Manage
                </button>
              </div>
              <div id="npc-picker-list" class="npc-picker-list"></div>
            </section>
          </div>

          <div class="builder-column builder-column-main">
            <section class="panel zone-panel">
              <div class="zone-panel-header">
                <h2>Zones</h2>
                <button id="add-zone">Add Zone</button>
              </div>
              <div id="zone-list" class="zone-list"></div>
            </section>
            <section class="panel zone-editor">
              <div class="zone-toolbar">
                <div class="mode-switcher">
                  <span class="mode-label">Edit Mode:</span>
                  <button data-mode="tile" class="mode-button active">Tiles</button>
                  <button data-mode="enemy" class="mode-button">Enemies</button>
                  <button data-mode="npc" class="mode-button">NPCs</button>
                  <button data-mode="transport" class="mode-button">Transports</button>
                  <button data-mode="spawn" class="mode-button">Spawn</button>
                </div>
                <div class="tile-controls" id="tile-controls">
                  <label class="brush-control" for="brush-size">
                    <span>Brush Size</span>
                    <input id="brush-size" type="number" min="1" max="25" value="1" />
                  </label>
                </div>
                <div class="transport-controls hidden" id="transport-controls">
                  <div class="transport-stage" id="transport-stage-indicator">
                    Select a source tile.
                  </div>
                  <div class="transport-pickers">
                    <button
                      type="button"
                      class="transport-pick-button"
                      id="transport-source-button"
                    >
                      Select source tile
                    </button>
                    <button
                      type="button"
                      class="transport-pick-button"
                      id="transport-destination-button"
                    >
                      Select destination tile
                    </button>
                  </div>
                  <label class="field-inline checkbox transport-two-way">
                    <input type="checkbox" id="transport-two-way" />
                    <span>Create two-way link</span>
                  </label>
                  <button type="button" id="transport-clear">Clear Selection</button>
                </div>
                <div class="enemy-mode-info hidden" id="enemy-mode-info">
                  <span>Placement Target:</span>
                  <span id="enemy-placement-target">None Selected</span>
                </div>
                <div class="npc-mode-info hidden" id="npc-mode-info">
                  <span>NPC Target:</span>
                  <span id="npc-placement-target">None Selected</span>
                </div>
              </div>
              <div id="zone-details" class="zone-details"></div>
              <div id="zone-grid" class="zone-grid-container"></div>
            </section>
            <section class="panel output-panel">
              <h2>Generated world.json</h2>
              <div class="output-actions">
                <button id="generate-world">Generate</button>
                <button id="load-world">Load From JSON</button>
              </div>
              <textarea
                id="world-output"
                placeholder="Paste existing JSON here or generate to view output..."
                spellcheck="false"
              ></textarea>
            </section>
          </div>
        </div>
      </section>

      <section class="builder-tab" data-tab-panel="sprites">
        <div class="sprite-layout">
          <section class="panel sprite-meta-panel">
            <h2>Palette Details</h2>
            <label class="field-label">
              Palette Name
              <input id="palette-name" type="text" placeholder="My Palette" />
            </label>
            <label class="field-label">
              Description
              <textarea id="palette-description" rows="2" placeholder="Optional notes..."></textarea>
            </label>
            <div class="sprite-actions">
              <button type="button" id="create-palette">New Palette</button>
              <button type="button" id="save-palette">Save Palette</button>
              <button type="button" id="delete-palette">Delete Palette</button>
            </div>
          </section>

          <section class="panel sprite-palette-panel">
            <h2>Palette Tiles</h2>
            <div id="palette-tile-list" class="palette-tile-list"></div>
          </section>

          <section class="panel sprite-assets-panel">
            <h2>Sprite Assets</h2>
            <div id="sprite-asset-list" class="sprite-asset-list"></div>
          </section>

          <section class="panel sprite-builder-panel">
            <h2>Sprite Builder</h2>
            <form id="sprite-form" class="sprite-form">
              <label class="field-inline">
                <span>Tile ID</span>
                <input id="sprite-tile-id" type="text" placeholder="e.g. 5" />
              </label>
              <label class="field-inline">
                <span>Fill</span>
                <input id="sprite-fill" type="text" placeholder="#ffffff" />
              </label>
              <label class="field-label">
                Sprite Path
                <input id="sprite-asset-path" type="text" placeholder="/assets/Sprite.png" />
              </label>
              <label class="field-inline checkbox">
                <input id="sprite-walkable" type="checkbox" checked />
                <span>Walkable</span>
              </label>
              <div class="sprite-preview" id="sprite-preview">
                <p>Select an asset to preview</p>
              </div>
              <button type="submit">Add / Update Tile</button>
            </form>
          </section>
        </div>
      </section>

      <section class="builder-tab" data-tab-panel="enemies">
        <div class="enemy-layout">
          <section class="panel enemy-editor-panel">
            <h2>Enemy Template Editor</h2>
            <form id="enemy-form" class="enemy-form">
              <div class="enemy-grid">
                <label class="field-label">
                  Template ID
                  <input id="enemy-id" type="text" placeholder="wild_sprig" required />
                </label>
                <label class="field-label">
                  Name
                  <input id="enemy-name" type="text" placeholder="Wild Sprig" required />
                </label>
                <label class="field-label enemy-sprite-field">
                  Sprite
                  <select id="enemy-sprite-select">
                    <option value="">None (Default)</option>
                  </select>
                </label>
                <div class="enemy-sprite-preview" id="enemy-sprite-preview">
                  <span>No sprite selected</span>
                </div>
                <label class="field-label">
                  Basic Type
                  <select id="enemy-basic-type">
                    <option value="melee">Melee</option>
                    <option value="magic">Magic</option>
                  </select>
                </label>
                <label class="field-label">
                  Level
                  <input id="enemy-level" type="number" min="1" value="1" required />
                </label>
                <fieldset class="enemy-attributes">
                  <legend>Attributes</legend>
                  <label>STR <input id="enemy-str" type="number" min="0" value="5" /></label>
                  <label>STA <input id="enemy-sta" type="number" min="0" value="5" /></label>
                  <label>AGI <input id="enemy-agi" type="number" min="0" value="5" /></label>
                  <label>INT <input id="enemy-int" type="number" min="0" value="2" /></label>
                  <label>WIS <input id="enemy-wis" type="number" min="0" value="2" /></label>
                </fieldset>
                <fieldset class="enemy-economy">
                  <legend>Rewards</legend>
                  <label>XP % <input id="enemy-xp" type="number" min="0" max="1" step="0.01" value="0.05" /></label>
                  <label>Gold <input id="enemy-gold" type="number" min="0" value="5" /></label>
                  <label>Spawn Chance <input id="enemy-spawn-chance" type="number" min="0" max="1" step="0.01" value="0.5" /></label>
                </fieldset>
                <fieldset class="enemy-rotation">
                  <legend>Rotation</legend>
                  <div class="rotation-picker">
                    <select id="enemy-ability-select"></select>
                    <button type="button" id="enemy-add-ability">Add Ability</button>
                  </div>
                  <div id="enemy-rotation-list" class="rotation-card-list"></div>
                </fieldset>
                <fieldset class="enemy-equipment">
                  <legend>Equipment</legend>
                  <div id="enemy-equipment-slots" class="equipment-slots"></div>
                </fieldset>
              </div>
              <div class="enemy-actions">
                <button type="submit" id="enemy-save">Save Template</button>
                <button type="button" id="enemy-reset">Clear</button>
              </div>
            </form>
          </section>

          <section class="panel enemy-library-panel">
            <h2>Saved Enemy Templates</h2>
            <div id="enemy-template-list" class="enemy-template-list"></div>
          </section>
        </div>
      </section>

      <section class="builder-tab" data-tab-panel="npcs">
        <div class="npc-layout">
          <section class="panel npc-list-panel">
            <div class="panel-header">
              <h2>NPCs</h2>
              <button type="button" id="npc-create">New NPC</button>
            </div>
            <div id="npc-list" class="npc-list"></div>
          </section>

          <section class="panel npc-editor-panel">
            <h2>NPC Details</h2>
            <form id="npc-form" class="npc-form">
              <label class="field-label">
                NPC ID
                <input id="npc-id" type="text" placeholder="village_elder" />
              </label>
              <label class="field-label">
                Name
                <input id="npc-name" type="text" placeholder="Village Elder" />
              </label>
              <label class="field-label">
                Facing
                <select id="npc-facing">
                  <option value="down">Down</option>
                  <option value="up">Up</option>
                  <option value="left">Left</option>
                  <option value="right">Right</option>
                </select>
              </label>
              <label class="field-label">
                Sprite
                <select id="npc-sprite-select">
                  <option value="">None (Default)</option>
                </select>
              </label>
              <div class="npc-sprite-preview" id="npc-sprite-preview">
                <span>No sprite selected</span>
              </div>
              <label class="field-label">
                Service
                <select id="npc-service">
                  <option value="">None</option>
                  <option value="shop">Shop</option>
                </select>
                <span class="field-hint">Assign optional interactions like shops for this NPC.</span>
              </label>
              <div class="npc-dialog-section">
                <div class="npc-dialog-header">
                  <span>Dialogue Entries</span>
                  <button type="button" id="npc-dialog-add">Add Entry</button>
                </div>
                <div id="npc-dialog-entry-list" class="npc-dialog-entry-list"></div>
                <label class="field-label">
                  Loop After Final Entry
                  <select id="npc-dialog-loop">
                    <option value="">Stay on final entry</option>
                  </select>
                  <span class="field-hint">
                    Choose which entry repeats after the last new dialogue has been shown.
                  </span>
                </label>
              </div>
              <p class="panel-note">Place NPCs from the World tab using the NPC edit mode.</p>
              <div class="npc-form-actions">
                <button type="submit" id="npc-save">Save NPC</button>
                <button type="button" id="npc-delete" class="danger">Delete NPC</button>
              </div>
            </form>
          </section>
        </div>
      </section>
    </main>
    <script src="/tooltip.js"></script>
    <script src="/world-builder.js" type="module"></script>
  </body>
</html>
